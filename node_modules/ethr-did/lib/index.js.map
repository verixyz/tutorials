{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { createJWT, ES256KSigner, hexToBytes, JWTVerified, Signer as JWTSigner, verifyJWT } from 'did-jwt'\nimport { Signer as TxSigner } from '@ethersproject/abstract-signer'\nimport { CallOverrides } from '@ethersproject/contracts'\nimport { computeAddress } from '@ethersproject/transactions'\nimport { computePublicKey } from '@ethersproject/signing-key'\nimport { Provider } from '@ethersproject/providers'\nimport { Wallet } from '@ethersproject/wallet'\nimport * as base64 from '@ethersproject/base64'\nimport { hexlify, hexValue, isBytes } from '@ethersproject/bytes'\nimport { Base58 } from '@ethersproject/basex'\nimport { toUtf8Bytes } from '@ethersproject/strings'\nimport { EthrDidController, interpretIdentifier, REGISTRY } from 'ethr-did-resolver'\nimport { Resolvable } from 'did-resolver'\n\nexport enum DelegateTypes {\n  veriKey = 'veriKey',\n  sigAuth = 'sigAuth',\n  enc = 'enc',\n}\n\ninterface IConfig {\n  identifier: string\n  chainNameOrId?: string | number\n\n  registry?: string\n\n  signer?: JWTSigner\n  alg?: 'ES256K' | 'ES256K-R'\n  txSigner?: TxSigner\n  privateKey?: string\n\n  rpcUrl?: string\n  provider?: Provider\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  web3?: any\n}\n\nexport type KeyPair = {\n  address: string\n  privateKey: string\n  publicKey: string\n  identifier: string\n}\n\ntype DelegateOptions = {\n  delegateType?: DelegateTypes\n  expiresIn?: number\n}\n\nexport class EthrDID {\n  public did: string\n  public address: string\n  public signer?: JWTSigner\n  public alg?: 'ES256K' | 'ES256K-R'\n  private owner?: string\n  private controller?: EthrDidController\n\n  constructor(conf: IConfig) {\n    const { address, publicKey, network } = interpretIdentifier(conf.identifier)\n    const chainNameOrId = typeof conf.chainNameOrId === 'number' ? hexValue(conf.chainNameOrId) : conf.chainNameOrId\n    if (conf.provider || conf.rpcUrl || conf.web3) {\n      let txSigner = conf.txSigner\n      if (conf.privateKey && typeof txSigner === 'undefined') {\n        txSigner = new Wallet(conf.privateKey)\n      }\n      this.controller = new EthrDidController(\n        conf.identifier,\n        undefined,\n        txSigner,\n        chainNameOrId,\n        conf.provider || conf.web3?.currentProvider,\n        conf.rpcUrl,\n        conf.registry || REGISTRY\n      )\n      this.did = this.controller.did\n    } else {\n      const net = network || chainNameOrId\n      let networkString = net ? `${net}:` : ''\n      if (networkString in ['mainnet:', '0x1:']) {\n        networkString = ''\n      }\n      this.did =\n        typeof publicKey === 'string' ? `did:ethr:${networkString}${publicKey}` : `did:ethr:${networkString}${address}`\n    }\n    this.address = address\n    if (conf.signer) {\n      this.signer = conf.signer\n      this.alg = conf.alg\n      if (!this.alg) {\n        console.warn(\n          'A JWT signer was specified but no algorithm was set. Please set the `alg` parameter when calling `new EthrDID()`'\n        )\n      }\n    } else if (conf.privateKey) {\n      this.signer = ES256KSigner(hexToBytes(conf.privateKey), true)\n      this.alg = 'ES256K-R'\n    }\n  }\n\n  static createKeyPair(chainNameOrId?: string | number): KeyPair {\n    const wallet = Wallet.createRandom()\n    const privateKey = wallet.privateKey\n    const address = computeAddress(privateKey)\n    const publicKey = computePublicKey(privateKey, true)\n    const net = typeof chainNameOrId === 'number' ? hexValue(chainNameOrId) : chainNameOrId\n    const identifier = net ? `did:ethr:${net}:${publicKey}` : publicKey\n    return { address, privateKey, publicKey, identifier }\n  }\n\n  async lookupOwner(cache = true): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    if (cache && this.owner) return this.owner\n    return this.controller?.getOwner(this.address)\n  }\n\n  async changeOwner(newOwner: string, txOptions?: CallOverrides): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.changeOwner(newOwner, {\n      ...txOptions,\n      from: owner,\n    })\n    this.owner = newOwner\n    return receipt.transactionHash\n  }\n\n  async addDelegate(\n    delegate: string,\n    delegateOptions?: DelegateOptions,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.addDelegate(\n      delegateOptions?.delegateType || DelegateTypes.veriKey,\n      delegate,\n      delegateOptions?.expiresIn || 86400,\n      { ...txOptions, from: owner }\n    )\n    return receipt.transactionHash\n  }\n\n  async revokeDelegate(\n    delegate: string,\n    delegateType = DelegateTypes.veriKey,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.revokeDelegate(delegateType, delegate, { ...txOptions, from: owner })\n    return receipt.transactionHash\n  }\n\n  async setAttribute(\n    key: string,\n    value: string | Uint8Array,\n    expiresIn = 86400,\n    /** @deprecated, please use txOptions.gasLimit */\n    gasLimit?: number,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.setAttribute(key, attributeToHex(key, value), expiresIn, {\n      gasLimit,\n      ...txOptions,\n      from: owner,\n    })\n    return receipt.transactionHash\n  }\n\n  async revokeAttribute(\n    key: string,\n    value: string | Uint8Array,\n    /** @deprecated please use `txOptions.gasLimit` */\n    gasLimit?: number,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.revokeAttribute(key, attributeToHex(key, value), {\n      gasLimit,\n      ...txOptions,\n      from: owner,\n    })\n    return receipt.transactionHash\n  }\n\n  // Create a temporary signing delegate able to sign JWT on behalf of identity\n  async createSigningDelegate(\n    delegateType = DelegateTypes.veriKey,\n    expiresIn = 86400\n  ): Promise<{ kp: KeyPair; txHash: string }> {\n    const kp = EthrDID.createKeyPair()\n    this.signer = ES256KSigner(hexToBytes(kp.privateKey), true)\n    const txHash = await this.addDelegate(kp.address, {\n      delegateType,\n      expiresIn,\n    })\n    return { kp, txHash }\n  }\n\n  // eslint-disable-next-line\n  async signJWT(payload: any, expiresIn?: number): Promise<string> {\n    if (typeof this.signer !== 'function') {\n      throw new Error('No signer configured')\n    }\n    const options = {\n      signer: this.signer,\n      alg: 'ES256K-R',\n      issuer: this.did,\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if (expiresIn) (<any>options)['expiresIn'] = expiresIn\n    return createJWT(payload, options)\n  }\n\n  async verifyJWT(jwt: string, resolver: Resolvable, audience = this.did): Promise<JWTVerified> {\n    return verifyJWT(jwt, { resolver, audience })\n  }\n}\n\nfunction attributeToHex(key: string, value: string | Uint8Array): string {\n  if (value instanceof Uint8Array || isBytes(value)) {\n    return hexlify(value)\n  }\n  const matchKeyWithEncoding = key.match(/^did\\/(pub|auth|svc)\\/(\\w+)(\\/(\\w+))?(\\/(\\w+))?$/)\n  const encoding = matchKeyWithEncoding?.[6]\n  const matchHexString = (<string>value).match(/^0x[0-9a-fA-F]*$/)\n  if (encoding && !matchHexString) {\n    if (encoding === 'base64') {\n      return hexlify(base64.decode(value))\n    }\n    if (encoding === 'base58') {\n      return hexlify(Base58.decode(value))\n    }\n  } else if (matchHexString) {\n    return <string>value\n  }\n\n  return hexlify(toUtf8Bytes(value))\n}\n"],"names":["DelegateTypes","EthrDID","constructor","conf","did","address","signer","alg","owner","controller","publicKey","network","interpretIdentifier","identifier","chainNameOrId","hexValue","provider","rpcUrl","web3","txSigner","privateKey","Wallet","EthrDidController","undefined","currentProvider","registry","REGISTRY","net","networkString","console","warn","ES256KSigner","hexToBytes","createKeyPair","wallet","createRandom","computeAddress","computePublicKey","lookupOwner","cache","Error","getOwner","changeOwner","newOwner","txOptions","from","receipt","transactionHash","addDelegate","delegate","delegateOptions","delegateType","veriKey","expiresIn","revokeDelegate","setAttribute","key","value","gasLimit","attributeToHex","revokeAttribute","createSigningDelegate","kp","txHash","signJWT","payload","options","issuer","createJWT","verifyJWT","jwt","resolver","audience","Uint8Array","isBytes","hexlify","matchKeyWithEncoding","match","encoding","matchHexString","base64","decode","Base58","toUtf8Bytes"],"mappings":"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"}